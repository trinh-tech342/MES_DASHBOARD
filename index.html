<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MES PRO | Advanced Manufacturing System</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css">
    
    <script src="https://unpkg.com/html5-qrcode" defer></script>
</head>
<body>
    <div class="glass-bg"></div>
    
    <div class="container">
        <header class="main-header">
            <div class="logo">‚ö° MES<span>PRO</span></div>
            <div class="status-workflow">
                <span id="badge-supervisor" class="badge active">QU·∫¢N ƒê·ªêC</span>
                <span class="connector"></span>
                <span id="badge-operator" class="badge">S·∫¢N XU·∫§T</span>
                <span class="connector"></span>
                <span id="badge-qc" class="badge">KI·ªÇM ƒê·ªäNH</span>
            </div>
        </header>

        <section class="dashboard-grid">
            <div class="dash-card">
                <div class="dash-icon" style="color: var(--primary);">üì¶</div>
                <div class="dash-info">
                    <span class="dash-label">T·ªîNG L√î H√îM NAY</span>
                    <h2 id="dash-total">0</h2>
                </div>
            </div>
            <div class="dash-card">
                <div class="dash-icon" style="color: var(--success);">‚úÖ</div>
                <div class="dash-info">
                    <span class="dash-label">ƒê√É HO√ÄN TH√ÄNH</span>
                    <h2 id="dash-completed">0</h2>
                </div>
            </div>
            <div class="dash-card">
                <div class="dash-icon" style="color: #ffcc00;">üïí</div>
                <div class="dash-info">
                    <span class="dash-label">ƒêANG S·∫¢N XU·∫§T</span>
                    <h2 id="dash-pending">0</h2>
                </div>
            </div>
        </section>

        <main class="sections-wrapper">
            <section class="glass-card section-1">
                <div class="card-head">
                    <span class="step-num">01</span>
                    <h3>Kh·ªüi t·∫°o L√¥ & ƒê∆°n h√†ng</h3>
                </div>
                <div class="input-row">
                    <div class="field">
                        <label>M√£ s·ªë L√¥</label>
                        <input type="text" id="batchID" placeholder="BATCH-2026-001">
                    </div>
                    <div class="field">
                        <label>M√£ ƒê∆°n h√†ng</label>
                        <input type="text" id="orderID" placeholder="ORD-9921">
                    </div>
                </div>
                <div class="field" style="margin-top: 20px;">
                    <label>S·∫¢N PH·∫®M (SKU)</label>
                    <input type="text" id="skuID" placeholder="T√™n s·∫£n ph·∫©m / SKU">
                </div>
                <button onclick="initBatch()" class="btn-glow primary">K√çCH HO·∫†T H·ªí S∆†</button>
            </section>

            <section class="glass-card section-2">
                <div class="card-head">
                    <span class="step-num">02</span>
                    <h3>Nh·∫≠t k√Ω V·∫≠n h√†nh</h3>
                </div>
                <div class="selection-group">
                    <label>CH·ªåN L√î V·∫¨N H√ÄNH</label>
                    <div class="input-with-button">
                        <select id="activeBatches" onchange="loadBatchData(this.value)">
                            <option value="">-- CH·ªåN M√É L√î --</option>
                        </select>
                        <button onclick="startScan('activeBatches')" class="btn-scan">QU√âT QR</button>
                    </div>
                </div>

                <div class="table-wrapper">
                    <table class="luxury-table">
                        <thead>
                            <tr>
                                <th>C√îNG ƒêO·∫†N</th>
                                <th>NGUY√äN LI·ªÜU</th>
                                <th>L√î RM</th>
                                <th>S·∫¢N L∆Ø·ª¢NG</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="outputBody"></tbody>
                    </table>
                </div>
                <div class="card-actions">
                    <button onclick="addRow('outputBody')" class="btn-outline">+ TH√äM D√íNG</button>
                    <button onclick="saveProduction()" class="btn-glow orange">L∆ØU D·ªÆ LI·ªÜU</button>
                </div>
            </section>

            <section class="glass-card section-3">
                <div class="card-head">
                    <span class="step-num">03</span>
                    <h3>Ki·ªÉm ƒë·ªãnh Ch·∫•t l∆∞·ª£ng</h3>
                </div>
                <div class="selection-group">
                    <select id="qcBatchSelect" onchange="loadQCData(this.value)">
                        <option value="">-- CH·ªåN L√î TH·∫®M ƒê·ªäNH --</option>
                    </select>
                </div>
                <div class="qc-grid">
                    <div class="status-toggle-container">
                        <span class="status-label fail">L·ªñI (FAIL)</span>
                        <label class="switch">
                            <input type="checkbox" id="pqcToggle" onchange="updateQCStatusText()">
                            <span class="slider round"></span>
                        </label>
                        <span class="status-label pass">ƒê·∫†T (PASS)</span>
                    </div>
                    <input type="hidden" id="pqcStatus" value="Fail"> 
                    <textarea id="qcNote" placeholder="Ghi ch√∫ th·∫©m ƒë·ªãnh..."></textarea>
                </div>
                <button onclick="finalizeQC()" class="btn-glow success">X√ÅC NH·∫¨N HO√ÄN TH√ÄNH</button>
            </section>

            <section class="glass-card section-pdf">
                <div class="card-head"><h3>Truy xu·∫•t & In</h3></div>
                <div class="search-flex">
                    <input type="text" id="searchId" placeholder="Nh·∫≠p Batch ID...">
                    <button onclick="exportBatchPDF()" class="btn-icon">T·∫¢I PDF</button>
                </div>
            </section>
        </main>
    </div>
    <div id="confirm-modal" class="camera-modal" style="display: none; background: rgba(0,0,0,0.8);">
        <div class="glass-card" style="max-width: 320px; text-align: center; padding: 30px;">
            <div style="font-size: 40px; margin-bottom: 15px;">üì∑</div>
            <h3 style="color: white; margin-bottom: 10px;">Y√™u c·∫ßu Camera</h3>
            <p style="color: var(--text-dim); font-size: 13px; margin-bottom: 25px;">
                H·ªá th·ªëng c·∫ßn truy c·∫≠p Camera ƒë·ªÉ qu√©t m√£ QR v·∫≠n h√†nh. B·∫°n c√≥ ƒë·ªìng √Ω k√≠ch ho·∫°t kh√¥ng?
            </p>
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button id="btn-cancel-cam" class="btn-outline" style="flex: 1;">H·ª¶Y</button>
                <button id="btn-allow-cam" class="btn-glow primary" style="flex: 1;">ƒê·ªíNG √ù</button>
            </div>
        </div>
    </div>
    <div id="camera-modal" class="camera-modal">
        <div class="camera-content">
            <div id="reader"></div>
            <button onclick="stopScan()" class="btn-glow orange">ƒê√ìNG CAMERA</button>
        </div>
    </div>

    <div id="toast-container" class="toast-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.autotable.min.js" defer></script>
    <script src="script.js" defer></script>
</body>
</html>
